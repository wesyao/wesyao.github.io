<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>kubernetes on azure in 30 minutes | MAMBA MENTALITY</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="KubernetesMicroservicesOrchestrator" />
  
  
  
  
  <meta name="description" content="This guide is meant to streamline you to your first Kubernetes (k8s) cluster on Microsoft Azure, with the essentials to monitor and scale your container service. In the interest of time/reading, this">
<meta name="keywords" content="Kubernetes,Microservices,Orchestrator">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes on Azure in 30 Minutes">
<meta property="og:url" content="http://yoursite.com/2017/12/04/kubernetes/kubernetes-on-azure-in-30-min/index.html">
<meta property="og:site_name" content="MAMBA MENTALITY">
<meta property="og:description" content="This guide is meant to streamline you to your first Kubernetes (k8s) cluster on Microsoft Azure, with the essentials to monitor and scale your container service. In the interest of time/reading, this">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://yoursite.com/2017/12/04/kubernetes/kubernetes-on-azure-in-30-min/grafana.png">
<meta property="og:updated_time" content="2017-12-05T00:12:46.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kubernetes on Azure in 30 Minutes">
<meta name="twitter:description" content="This guide is meant to streamline you to your first Kubernetes (k8s) cluster on Microsoft Azure, with the essentials to monitor and scale your container service. In the interest of time/reading, this">
<meta name="twitter:image" content="http://yoursite.com/2017/12/04/kubernetes/kubernetes-on-azure-in-30-min/grafana.png">
  
    <link rel="alternate" href="/atom.xml" title="MAMBA MENTALITY" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="/css/images/mylogo.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">Home</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">Archives</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">Categories</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">Tags</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">About</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-kubernetes/kubernetes-on-azure-in-30-min" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Kubernetes on Azure in 30 Minutes
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/12/04/kubernetes/kubernetes-on-azure-in-30-min/" class="article-date">
	  <time datetime="2017-12-05T00:05:21.000Z" itemprop="datePublished">2017-12-04</time>
	</a>

      
      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		PV:<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>This guide is meant to streamline you to your first Kubernetes (k8s) cluster on Microsoft Azure, with the essentials to monitor and scale your container service. In the interest of time/reading, this will <strong>NOT</strong> be an indepth tutorial on Kubernetes.</p>
<h1 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h1><p>We will be using cli tools and package managers to provision azure resources and to manage our clusters.</p>
<h2 id="Install-Azure-CLI"><a href="#Install-Azure-CLI" class="headerlink" title="Install Azure CLI"></a>Install Azure CLI</h2><p>Azure CLI is used to deploy and manage resources within your azure subscription</p>
<h3 id="Install-on-Mac-with-Homebrew"><a href="#Install-on-Mac-with-Homebrew" class="headerlink" title="Install on Mac with Homebrew"></a>Install on Mac with Homebrew</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">brew update</div><div class="line">brew install azure-cli</div></pre></td></tr></table></figure>
<h3 id="Install-on-Windows"><a href="#Install-on-Windows" class="headerlink" title="Install on Windows"></a>Install on Windows</h3><p>Download and run <a href="https://aka.ms/InstallAzureCliWindows" target="_blank" rel="external">Azure CLI Installer (MSI)</a></p>
<p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest" target="_blank" rel="external">For more informaion on installing Azure CLI</a></p>
<h3 id="Install-Kubernetes-CLI-kubectl"><a href="#Install-Kubernetes-CLI-kubectl" class="headerlink" title="Install Kubernetes CLI (kubectl)"></a>Install Kubernetes CLI (kubectl)</h3><p>Kubectl is used to deploy and manage your kubernetes cluster</p>
<h3 id="Install-on-Mac-with-Homebrew-1"><a href="#Install-on-Mac-with-Homebrew-1" class="headerlink" title="Install on Mac with Homebrew"></a>Install on Mac with Homebrew</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install kubectl</div></pre></td></tr></table></figure>
<h3 id="Install-on-Windows-1"><a href="#Install-on-Windows-1" class="headerlink" title="Install on Windows"></a>Install on Windows</h3><ol>
<li>Download latest release from <a href="https://storage.googleapis.com/kubernetes-release/release/v1.8.0/bin/windows/amd64/kubectl.exe" target="_blank" rel="external">here</a></li>
<li>Add binary to PATH<ul>
<li>Open Control Panel</li>
<li>Open Advanced System Properties</li>
<li>Click Environment Variables</li>
<li>Edit Path under <strong>System variables</strong></li>
<li>Add Path to kubectl executable</li>
</ul>
</li>
</ol>
<p><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl" target="_blank" rel="external">For more information on installing Kubernetes CLI (kubectl)</a></p>
<h1 id="Setting-up-Azure-Container-Service"><a href="#Setting-up-Azure-Container-Service" class="headerlink" title="Setting up Azure Container Service"></a>Setting up Azure Container Service</h1><p>Create a Resource Group and Create the Azure Container Service within that group. This will create a cluster named MyK8sCluster with 1 linux master and 3 linux agent nodes.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">az group create --name AzureKubernetesTutorial --location westus</div><div class="line">az acs create --orchestrator-type kubernetes --resource-group AzureKubernetesTutorial --name MyK8sCluster --generate-ssh-keys</div></pre></td></tr></table></figure>
<h1 id="Connect-to-your-Cluster"><a href="#Connect-to-your-Cluster" class="headerlink" title="Connect to your Cluster"></a>Connect to your Cluster</h1><p>Kubernetes CLI needs to be configured to access your cluster from your machine. This command configures your <code>.kube/config</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">az acs kubernetes get-credentials --resource-group=myResourceGroup --name=myK8sCluster</div><div class="line"></div><div class="line">kubectl get nodes</div><div class="line"></div><div class="line">NAME                    STATUS    ROLES     AGE       VERSION</div><div class="line">k8s-agent-631d3265-0    Ready     agent     6d        v1.7.7</div><div class="line">k8s-agent-631d3265-1    Ready     agent     6d        v1.7.7</div><div class="line">k8s-agent-631d3265-2    Ready     agent     6d        v1.7.7</div><div class="line">k8s-master-631d3265-0   Ready     master    6d        v1.7.7</div></pre></td></tr></table></figure>
<h1 id="Monitoring-your-Cluster"><a href="#Monitoring-your-Cluster" class="headerlink" title="Monitoring your Cluster"></a>Monitoring your Cluster</h1><p>Although k8s will try to keep up your clusters health, proactive monitoring is good for seeing CPU, memory, and disk metrics as well as how your pod is behaving within your cluster.</p>
<h2 id="Ensure-Heapster-is-installed"><a href="#Ensure-Heapster-is-installed" class="headerlink" title="Ensure Heapster is installed"></a>Ensure Heapster is installed</h2><p>Heapster is a pod in your cluster that is responsible for aggregating monitoring data across all nodes and pods within your cluster. It is necessary to have Heapster for viewing data on Grafana.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">kubectl get pods --namespace=kube-system</div><div class="line"></div><div class="line">NAME                                            READY     STATUS    RESTARTS   AGE</div><div class="line">heapster-342135353-zq0fv                        2/2       Running   0          4d</div><div class="line">kube-addon-manager-k8s-master-631d3265-0        1/1       Running   0          8d</div><div class="line">kube-apiserver-k8s-master-631d3265-0            1/1       Running   0          8d</div><div class="line">kube-controller-manager-k8s-master-631d3265-0   1/1       Running   0          8d</div><div class="line">kube-dns-v20-3003781527-13rws                   3/3       Running   0          8d</div><div class="line">kube-dns-v20-3003781527-n6rj6                   3/3       Running   0          8d</div><div class="line">kube-proxy-3fwdq                                1/1       Running   0          8d</div><div class="line">kube-proxy-7698s                                1/1       Running   0          8d</div><div class="line">kube-proxy-d421d                                1/1       Running   0          8d</div><div class="line">kube-proxy-fvp2m                                1/1       Running   0          8d</div><div class="line">kube-scheduler-k8s-master-631d3265-0            1/1       Running   0          8d</div><div class="line">kubernetes-dashboard-924040265-tflfr            1/1       Running   0          8d</div><div class="line">tiller-deploy-4061877079-d758t                  1/1       Running   0          2h</div></pre></td></tr></table></figure>
<h2 id="Basic-Node-Metrics-with-Kubectl"><a href="#Basic-Node-Metrics-with-Kubectl" class="headerlink" title="Basic Node Metrics with Kubectl"></a>Basic Node Metrics with Kubectl</h2><p>The fastest way to see metrics about your node is to use kubectl.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">kubectl top node</div><div class="line"></div><div class="line">NAME                    CPU(cores)   CPU%      MEMORY(bytes)   MEMORY%</div><div class="line">k8s-master-631d3265-0   120m         6%        1928Mi          28%</div><div class="line">k8s-agent-631d3265-2    44m          2%        1222Mi          17%</div><div class="line">k8s-agent-631d3265-0    31m          1%        1310Mi          19%</div><div class="line">k8s-agent-631d3265-1    36m          1%        1367Mi          19%</div></pre></td></tr></table></figure>
<h2 id="Installing-Grafana-and-Influx-DB"><a href="#Installing-Grafana-and-Influx-DB" class="headerlink" title="Installing Grafana and Influx DB"></a>Installing Grafana and Influx DB</h2><ol>
<li><p>Download InfluxDB deployment manifest by using curl or by going to the <a href="https://raw.githubusercontent.com/kubernetes/heapster/release-1.5/deploy/kube-config/influxdb/influxdb.yaml" target="_blank" rel="external">url</a> and copy and pasting the source</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -o ./influxdb.yaml -k https://raw.githubusercontent.com/kubernetes/heapster/release-1.5/deploy/kube-config/influxdb/influxdb.yaml</div></pre></td></tr></table></figure>
</li>
<li><p>Download Grafana deployment manifest by using curl or bu going to the <a href="https://raw.githubusercontent.com/kubernetes/heapster/release-1.5/deploy/kube-config/influxdb/grafana.yaml" target="_blank" rel="external">url</a> and copy and pasting the source</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -o ./grafana.yaml -k https://raw.githubusercontent.com/kubernetes/heapster/release-1.5/deploy/kube-config/influxdb/grafana.yaml</div></pre></td></tr></table></figure>
</li>
<li><p>Edit both influxdb.yaml and grafana.yaml and remove </p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#influx.yaml</span></div><div class="line">kubernetes.io/cluster-service: <span class="string">'true'</span></div><div class="line">kubernetes.io/name: monitoring-influxdb</div><div class="line"></div><div class="line"><span class="comment">#grafana.yaml</span></div><div class="line">kubernetes.io/cluster-service: <span class="string">'true'</span></div><div class="line">kubernetes.io/name: monitoring-grafana</div></pre></td></tr></table></figure>
</li>
<li><p>Run both influxedb and grafana manifest files. You should see both influxdb and grafana as <code>Running</code> pods in your <code>kube-system</code> namespace. Notice the newly created grafana and influxdb pods.</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">kubectl apply -f influxdb.yaml</div><div class="line">kubectl apply -f grafana.yaml</div><div class="line"></div><div class="line">kubectl get pods --namespace kube-system</div><div class="line">NAME                                            READY     STATUS    RESTARTS   AGE</div><div class="line">heapster-342135353-zq0fv                        2/2       Running   0          4d</div><div class="line">kube-addon-manager-k8s-master-631d3265-0        1/1       Running   0          8d</div><div class="line">kube-apiserver-k8s-master-631d3265-0            1/1       Running   0          8d</div><div class="line">kube-controller-manager-k8s-master-631d3265-0   1/1       Running   0          8d</div><div class="line">kube-dns-v20-3003781527-13rws                   3/3       Running   0          8d</div><div class="line">kube-dns-v20-3003781527-n6rj6                   3/3       Running   0          8d</div><div class="line">kube-proxy-3fwdq                                1/1       Running   0          8d</div><div class="line">kube-proxy-7698s                                1/1       Running   0          8d</div><div class="line">kube-proxy-d421d                                1/1       Running   0          8d</div><div class="line">kube-proxy-fvp2m                                1/1       Running   0          8d</div><div class="line">kube-scheduler-k8s-master-631d3265-0            1/1       Running   0          8d</div><div class="line">kubernetes-dashboard-924040265-tflfr            1/1       Running   0          8d</div><div class="line">monitoring-grafana-1219411114-bmgd8             1/1       Running   0          52s</div><div class="line">monitoring-influxdb-3087546307-wlxgn            1/1       Running   0          1m</div><div class="line">tiller-deploy-4061877079-d758t                  1/1       Running   0          2h</div></pre></td></tr></table></figure>
</li>
<li><p>Configure Heapster to use InfluxDB as the data store for your monitoring metrics. Edit your heapster deployment by going under spec &gt; containers &gt; command property and changing the contents from:</p>
 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attr">- command:</span></div><div class="line"><span class="bullet">-</span> <span class="string">/heapster</span></div><div class="line"><span class="bullet">-</span> <span class="bullet">--source=kubernetes.summary_api:""</span></div></pre></td></tr></table></figure>
<p> to</p>
 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attr">- command:</span></div><div class="line"><span class="bullet">-</span> <span class="string">/heapster</span></div><div class="line"><span class="bullet">-</span> <span class="bullet">--source=kubernetes.summary_api:""</span></div><div class="line"><span class="bullet">-</span> <span class="bullet">--sink=influxdb:http://monitoring-influxdb.kube-system.svc:8086</span></div></pre></td></tr></table></figure>
<p> Save and exit from your editor. This will trigger a change in the deployment. Heapster will restart using InfluxDB as the data store.</p>
</li>
<li><p>To verify your Heapster deployment change</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">getHeapster</span></span>() &#123; kubectl get pods -o go-template --template <span class="string">'&#123;&#123;range .items&#125;&#125;&#123;&#123;.metadata.name&#125;&#125;&#123;&#123;"\n"&#125;&#125;&#123;&#123;end&#125;&#125;'</span> --namespace=kube-system | grep -i heapster; &#125;</div><div class="line"></div><div class="line">kubectl logs $(getHeapster) --namespace=kube-system -c heapster</div><div class="line"></div><div class="line">I1130 01:11:32.014809       1 heapster.go:72] /heapster --<span class="built_in">source</span>=kubernetes.summary_api:<span class="string">""</span> --sink=influxdb:http://monitoring-influxdb.kube-system.svc:8086</div><div class="line">I1130 01:11:32.014884       1 heapster.go:73] Heapster version v1.4.2</div><div class="line">I1130 01:11:32.015079       1 configs.go:61] Using Kubernetes client with master <span class="string">"https://10.0.0.1:443"</span> and version v1</div><div class="line">I1130 01:11:32.015091       1 configs.go:62] Using kubelet port 10255</div><div class="line">I1130 01:11:32.023608       1 influxdb.go:278] created influxdb sink with options: host:monitoring-influxdb.kube-system.svc:8086 user:root db:k8s</div><div class="line">I1130 01:11:32.023678       1 heapster.go:196] Starting with InfluxDB Sink</div><div class="line">I1130 01:11:32.023689       1 heapster.go:196] Starting with Metric Sink</div><div class="line">I1130 01:11:32.120803       1 heapster.go:106] Starting heapster on port 8082</div><div class="line">I1130 01:12:05.123163       1 influxdb.go:241] Created database <span class="string">"k8s"</span> on influxDB server at <span class="string">"monitoring-influxdb.kube-system.svc:8086"</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Viewing-Grafana-Dashboards"><a href="#Viewing-Grafana-Dashboards" class="headerlink" title="Viewing Grafana Dashboards"></a>Viewing Grafana Dashboards</h2><ol>
<li>Run <code>kubectl proxy</code></li>
<li>To view your cluster metrics go to: <a href="http://localhost:8001/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy/dashboard/db/cluster" target="_blank" rel="external">http://localhost:8001/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy/dashboard/db/cluster</a></li>
<li>To view your pod metrics go to: <a href="http://localhost:8001/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy/dashboard/db/pod" target="_blank" rel="external">http://localhost:8001/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy/dashboard/db/pod</a></li>
</ol>
<img src="/2017/12/04/kubernetes/kubernetes-on-azure-in-30-min/grafana.png" alt="grafana.png" title="">
<h1 id="Deploying-your-First-Pod"><a href="#Deploying-your-First-Pod" class="headerlink" title="Deploying your First Pod"></a>Deploying your First Pod</h1><p>Now that you have set up monitoring on your cluster, it is time to deploy your first pod. For this example, we will be deploying a simple node app that has already been uploaded to <a href="https://hub.docker.com/r/wesyao/hello-kubernetes-app/" target="_blank" rel="external">dockerhub</a>. Your clusters state is defined through manifest files. K8s will continue checking if the current state is the same as what was defined in the manifest files.</p>
<ol>
<li><p>Download the example deployment manifest by using curl or going to the <a href="https://raw.githubusercontent.com/wesyao/hello-kubernetes-app/master/deployment/hello-kubernetes.yaml" target="_blank" rel="external">url</a> and copy and pasting the source</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -o ./hello-kubernetes.yaml -k https://raw.githubusercontent.com/wesyao/hello-kubernetes-app/master/deployment/hello-kubernetes.yaml</div></pre></td></tr></table></figure>
</li>
<li><p>This manifest file describes to k8s what you want deployed and how the state of the cluster should look like. In this manifest file, we will be deploying the hello-kubernetes-app from dockerhub, requiring that there will be 3 replicas of this pod, and specifying what ports we want to traffic to flow through. We also define a service that exposes an external IP for us to hit once deployed. For more information regarding how to write your own manifest files, see the k8s <a href="https://kubernetes.io/docs/api-reference/v1.8/" target="_blank" rel="external">documentation</a>.</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">kubecutl apply -f hello-kubernetes.yaml</div><div class="line"></div><div class="line">deployment <span class="string">"deployment-hello-kubernetes"</span> configured</div><div class="line">service <span class="string">"service-hello-kubernetes"</span> configured</div></pre></td></tr></table></figure>
</li>
<li><p>Verify your deployment was successful. Notice the service-hello-kubernetes is allocating an <code>External IP</code> so that we can access our pods from outside the cluster.</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">kubecutl get pods,svc</div><div class="line"></div><div class="line">NAME                                              READY     STATUS    RESTARTS   AGE</div><div class="line">po/deployment-hello-kubernetes-2906022042-0fxdz   1/1       Running   0          7s</div><div class="line">po/deployment-hello-kubernetes-2906022042-29l3j   1/1       Running   0          7s</div><div class="line">po/deployment-hello-kubernetes-2906022042-kb519   1/1       Running   0          7s</div><div class="line"></div><div class="line">NAME                           TYPE           CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE</div><div class="line">svc/kubernetes                 ClusterIP      10.0.0.1      &lt;none&gt;        443/TCP        9d</div><div class="line">svc/service-hello-kubernetes   LoadBalancer   10.0.138.10   &lt;pending&gt;     80:31934/TCP   7s</div></pre></td></tr></table></figure>
</li>
<li><p>Once your service has finished allocating an <code>External IP</code>, you can access this from your favorite browser. Once you enter the <code>External IP</code> in your browser, you should see <code>Hello Kubernetes!</code>.</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">kubectl get svc</div><div class="line"></div><div class="line">NAME                       TYPE           CLUSTER-IP    EXTERNAL-IP      PORT(S)        AGE</div><div class="line">kubernetes                 ClusterIP      10.0.0.1      &lt;none&gt;           443/TCP        9d</div><div class="line">service-hello-kubernetes   LoadBalancer   10.0.138.10   104.42.238.180   80:31934/TCP   5m</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="Patting-Yourself-on-the-Back"><a href="#Patting-Yourself-on-the-Back" class="headerlink" title="Patting Yourself on the Back"></a>Patting Yourself on the Back</h1><p>Congratulations! Sometimes it’s hard to remember to stop and smell the roses, but you’ve now stood up your first kubernetes cluster, added monitoring on your nodes, and deployed your first application on your cluster! This is no small feat. There is a vast amount of knowledge and details that weren’t covered here, but there is tons of information on the <a href="https://kubernetes.io/docs/concepts/" target="_blank" rel="external">k8s documentation</a> to give you a deeper dive on the concepts we covered.</p>

      
    </div>
    <footer class="article-footer">
      
        <div id="donation_div"></div>

<script src="/js/vdonate.js"></script>
<script>
var a = new Donate({
  title: '如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作!', // 可选参数，打赏标题
  btnText: 'Donate', // 可选参数，打赏按钮文字
  el: document.getElementById('donation_div'),
  wechatImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/WeChanQR.png',
  alipayImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/AliPayQR.jpg'
});
</script>
      
      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kubernetes/">Kubernetes</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Microservices/">Microservices</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Orchestrator/">Orchestrator</a></li></ul>

    </footer>
  </div>
  
    
  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Prerequisites"><span class="nav-number">1.</span> <span class="nav-text">Prerequisites</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-Azure-CLI"><span class="nav-number">1.1.</span> <span class="nav-text">Install Azure CLI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-on-Mac-with-Homebrew"><span class="nav-number">1.1.1.</span> <span class="nav-text">Install on Mac with Homebrew</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-on-Windows"><span class="nav-number">1.1.2.</span> <span class="nav-text">Install on Windows</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-Kubernetes-CLI-kubectl"><span class="nav-number">1.1.3.</span> <span class="nav-text">Install Kubernetes CLI (kubectl)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-on-Mac-with-Homebrew-1"><span class="nav-number">1.1.4.</span> <span class="nav-text">Install on Mac with Homebrew</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-on-Windows-1"><span class="nav-number">1.1.5.</span> <span class="nav-text">Install on Windows</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Setting-up-Azure-Container-Service"><span class="nav-number">2.</span> <span class="nav-text">Setting up Azure Container Service</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Connect-to-your-Cluster"><span class="nav-number">3.</span> <span class="nav-text">Connect to your Cluster</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Monitoring-your-Cluster"><span class="nav-number">4.</span> <span class="nav-text">Monitoring your Cluster</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Ensure-Heapster-is-installed"><span class="nav-number">4.1.</span> <span class="nav-text">Ensure Heapster is installed</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Basic-Node-Metrics-with-Kubectl"><span class="nav-number">4.2.</span> <span class="nav-text">Basic Node Metrics with Kubectl</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Installing-Grafana-and-Influx-DB"><span class="nav-number">4.3.</span> <span class="nav-text">Installing Grafana and Influx DB</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Viewing-Grafana-Dashboards"><span class="nav-number">4.4.</span> <span class="nav-text">Viewing Grafana Dashboards</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Deploying-your-First-Pod"><span class="nav-number">5.</span> <span class="nav-text">Deploying your First Pod</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Patting-Yourself-on-the-Back"><span class="nav-number">6.</span> <span class="nav-text">Patting Yourself on the Back</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2017 MAMBA MENTALITY All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				UV : <span id="busuanzi_value_site_uv"></span> |  
				PV : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>




  <script src="/js/dialog.js"></script>








	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            MAMBA MENTALITY
          </div>
          <div class="panel-body">
            Copyright © 2017 Wes Yao All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>